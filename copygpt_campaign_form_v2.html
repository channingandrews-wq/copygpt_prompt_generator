<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CopyGPT Campaign Intake</title>
  <style>
    :root{
      --bg:#ffffff;
      --panel:#f7f7f7;
      --text:#111111;
      --muted:#444444;
      --accent:#0b57d0;
      --danger:#c62828;
      --ok:#2e7d32;
      --border:#dddddd;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:var(--bg);
      color:var(--text);
    }
    .container{max-width:1100px;margin:0 auto;padding:24px}
    h1{font-size:28px;margin:0 0 8px}
    p.lead{margin:0 0 24px;color:var(--muted)}
    form{display:grid;gap:14px}
    fieldset{border:1px solid var(--border);border-radius:14px;padding:16px;background:var(--panel)}
    legend{padding:0 8px;color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .row-1{display:grid;grid-template-columns:1fr;gap:12px}
    label{display:block;font-weight:600;margin-bottom:6px}
    .desc{font-weight:500;color:var(--muted);font-size:13px;margin-top:4px}
    input[type="text"], input[type="date"], input[type="search"], select, textarea{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--text)
    }
    textarea{min-height:100px;resize:vertical}
    .hint{font-size:12px;color:var(--muted)}
    .required::after{content:" *";color:var(--danger);font-weight:700}
    .note{background:#fff;border-left:3px solid var(--accent);padding:10px 12px;border-radius:10px;color:var(--muted)}
    .error{color:var(--danger);font-size:13px;margin-top:6px;display:none}
    .hidden{display:none !important}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{appearance:none;border:1px solid var(--border);background:#ffffff;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    button.primary{background:linear-gradient(135deg,#0b57d0,#3b82f6);border:none;color:#fff}
    button.ghost{background:transparent}
    .output{white-space:pre-wrap;background:#fff;border:1px dashed #cfcfcf;border-radius:12px;padding:14px;min-height:120px}
    .copy-section {margin-top: 10px;text-align: center;}
    .support-msg{color:var(--danger);font-weight:600}
  </style>
</head>
<body>
  <div class="container">
    <h1>CopyGPT Prompt Generator</h1>
    <p class="lead">Fill out the form to generate a complete prompt for you. The fields will update as you make selections.</p>

    <form id="intakeForm" novalidate>
      <!-- (all form fields unchanged for brevity) -->

      <div class="actions">
        <button type="button" class="primary" id="generateBtn">Generate Response</button>
        <button type="reset" class="ghost" id="resetBtn">Reset</button>
      </div>

      <fieldset>
        <legend>Generated Response</legend>
        <div id="output" class="output" aria-live="polite"></div>
        <div class="copy-section">
          <button type="button" id="copyBtn">Copy Text</button>
        </div>
      </fieldset>
    </form>
  </div>

  <script>
    const el = (id) => document.getElementById(id);

    // Shared
    const audience = el('audience');
    const output = el('output');
    const copyBtn = el('copyBtn');
    const generateBtn = el('generateBtn');
    const resetBtn = el('resetBtn');

    // Consumer refs
    const consumerBlock = el('consumerBlock');
    const channel = el('channel');
    const unsupportedMsg = el('unsupportedMsg');
    const epBlock = el('epBlock');
    const segment = el('segment');
    const behavior = el('behavior');
    const submarkets = el('submarkets');
    const usecase = el('usecase');
    const action = el('action');
    const takeaway = el('takeaway');
    const feature = el('feature');
    const lob = el('lob');
    const cta = el('cta');
    const hasPromo = el('hasPromo');
    const promoBlock = el('promoBlock');
    const promoType = el('promoType');
    const discount = el('discount');
    const startDate = el('startDate');
    const endDate = el('endDate');
    const minSubtotal = el('minSubtotal');
    const maxDiscount = el('maxDiscount');
    const pickupOnly = el('pickupOnly');
    const promoCode = el('promoCode');
    const dashpassOnly = el('dashpassOnly');
    const hasSecondary = el('hasSecondary');
    const secondaryBlock = el('secondaryBlock');
    const secondaryObjective = el('secondaryObjective');
    const secondaryLOB = el('secondaryLOB');
    const secondaryCTA = el('secondaryCTA');

    // Dasher refs
    const dasherBlock = el('dasherBlock');
    const d_channel = el('d_channel');
    const d_segment = el('d_segment');
    const d_behavior = el('d_behavior');
    const d_submarkets = el('d_submarkets');
    const d_usecase = el('d_usecase');
    const d_action = el('d_action');
    const d_takeaway = el('d_takeaway');
    const d_feature = el('d_feature');
    const d_cta = el('d_cta');
    const d_hasPromo = el('d_hasPromo');
    const d_promoBlock = el('d_promoBlock');
    const d_promoType = el('d_promoType');
    const d_otherWrap = el('d_otherWrap');
    const d_otherPromo = el('d_otherPromo');
    const d_startDate = el('d_startDate');
    const d_endDate = el('d_endDate');
    const d_minDeliveries = el('d_minDeliveries');
    const d_stdPayout = el('d_stdPayout');
    const d_maxPayout = el('d_maxPayout');
    const d_streaksBlock = el('d_streaksBlock');
    const d_consecDays = el('d_consecDays');
    const d_additionalPayout = el('d_additionalPayout');
    const d_secondaryBlock = el('d_secondaryBlock');
    const d_secondaryObjective = el('d_secondaryObjective');
    const d_secondaryLOB = el('d_secondaryLOB');
    const d_secondaryCTA = el('d_secondaryCTA');

    // Merchant placeholder
    const merchantBlock = el('merchantBlock');

    // Validation helpers (unchanged)
    const reDate = /^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{2}$/;
    const reMoneyNum = /^\d+(?:\.\d{1,2})?$/;

    function showError(id, show) {
      const e = el(id);
      if (!e) return;
      e.style.display = show ? 'block' : 'none';
    }
    function validateRequired(node, errId){ const ok = !!(node && node.value && node.value.trim().length); showError(errId, !ok); return ok; }
    function validateStartsWithWho(node, errId){ const v=(node.value||'').trim().toLowerCase(); const ok=v.length>0 && v.startsWith('who'); showError(errId,!ok); return ok; }
    function validateDate(node, errId){ const v=(node.value||'').trim(); const ok=reDate.test(v); showError(errId,!ok); return ok; }
    function validateNumber(node, errId){ const v=(node.value||'').trim(); const ok=reMoneyNum.test(v); showError(errId,!ok); return ok; }
    function validateHasDollar(node, errId){ const v=(node.value||'').trim().toLowerCase(); const ok = v.includes('$'); showError(errId, !ok); return ok; }
    function validateHasDollarOrNA(node, errId){ const v=(node.value||'').trim().toLowerCase(); const ok = v==='n/a' || v.includes('$'); showError(errId, !ok); return ok; }

    // Visibility (unchanged)
    function updateVisibility(){
      consumerBlock.classList.toggle('hidden', audience.value!=='Consumer');
      dasherBlock.classList.toggle('hidden', audience.value!=='Dasher');
      merchantBlock.classList.toggle('hidden', audience.value!=='Merchant');

      if (audience.value==='Consumer'){
        const ch = channel.value;
        const isEP = ch==='Email' || ch==='Push Notification';
        epBlock.classList.toggle('hidden', !isEP);
        unsupportedMsg.classList.toggle('hidden', isEP || !ch);
      } else {
        unsupportedMsg.classList.add('hidden');
        epBlock.classList.add('hidden');
      }

      promoBlock.classList.toggle('hidden', hasPromo.value!=='Yes');
      secondaryBlock.classList.toggle('hidden', hasSecondary.value!=='Yes');
      d_promoBlock.classList.toggle('hidden', d_hasPromo.value!=='Yes');
      d_streaksBlock.classList.toggle('hidden', d_promoType.value!=='streaks');
      d_otherWrap.classList.toggle('hidden', d_promoType.value!=='other');
    }

    audience.addEventListener('change', updateVisibility);
    channel.addEventListener('change', updateVisibility);
    hasPromo.addEventListener('change', updateVisibility);
    hasSecondary.addEventListener('change', updateVisibility);
    d_hasPromo.addEventListener('change', updateVisibility);
    d_promoType.addEventListener('change', updateVisibility);

    // Generate Consumer
    function generateConsumer(){
      let valid = true;
      valid &= validateRequired(channel, 'channelErr');
      const ch = channel.value;
      const isEP = ch==='Email' || ch==='Push Notification';
      if (isEP){
        valid &= validateRequired(segment,'segmentErr');
        valid &= validateStartsWithWho(behavior,'behaviorErr');
        valid &= validateRequired(submarkets,'submarketsErr');
        valid &= validateRequired(usecase,'usecaseErr');
        valid &= validateRequired(action,'actionErr');
        valid &= validateRequired(takeaway,'takeawayErr');
        if (hasPromo.value==='Yes'){
          valid &= validateRequired(promoType,'promoTypeErr');
          valid &= validateHasDollarOrPercent(discount,'discountErr');
          valid &= validateDate(startDate,'startErr');
          valid &= validateDate(endDate,'endErr');
          valid &= validateNumber(minSubtotal,'minErr');
          valid &= validateNumber(maxDiscount,'maxErr');
        }
      }
      if (!valid) return '';

      const aud = 'Consumer';
      const seg = segment.value || '';
      const beh = (behavior.value||'').trim();
      const loc = (submarkets.value||'').trim();
      const uc  = usecase.value || '';
      const callToAction = cta.value || 'N/A';
      const act = (action.value||'').trim();
      const take = (takeaway.value||'').trim();
      const feat = (feature.value||'').trim() || 'N/A';

      let txt = `I need a(n) ${ch} for our DoorDash ${aud} team targeting ${seg} ${beh} in ${loc}. Use Case: ${uc}. CTA: ${callToAction}.\n\n` +
                `The main action we want the consumer to take: ${act}\n` +
                `The most important takeaway for Consumer: ${take}\n` +
                `Details about feature/product: ${feat}`;

      if (hasPromo.value==='Yes'){
        const pType = promoType.value;
        const disc = (discount.value||'').trim();
        const start = (startDate.value||'').trim();
        const end = (endDate.value||'').trim();
        const min = Number((minSubtotal.value||'0').trim());
        const max = Number((maxDiscount.value||'0').trim());
        const pickOnly = pickupOnly.value==='Yes';
        const code = (promoCode.value||'').trim();
        const dpOnly = dashpassOnly.value==='Yes';

        txt += `\n\nThis campaign includes a [${pType} promo]`;
        const money = (n)=> isNaN(n)?'0':n.toString();
        const minTxt = `$${money(min)}`;
        const maxTxt = `$${money(max)}`;

        if (pType==='Save Up To $X'){
          txt += `\nOffer: ${disc} off their next order of ${minTxt} up to ${maxTxt} – valid between ${start} and ${end}.`;
        } else if (pType==='X Off Your Order'){
          txt += `\nOffer: ${disc} off their next order of ${minTxt} – valid between ${start} and ${end}.`;
        } else if (pType==='$0 Delivery Fee'){
          txt += `\nOffer: $0 Delivery Fee off their next order of ${minTxt} – valid between ${start} and ${end}.`;
        } else if (pType==='$ X off Delivery Fee'){
          txt += `\nOffer: ${disc} off your Delivery Fee on their next order of ${minTxt} – valid between ${start} and ${end}.`;
        } else {
          txt += `\nOffer: ${disc} – valid between ${start} and ${end}.`;
        }
        if (pickOnly) txt += ' Pick up orders only.';
        if (dpOnly) txt += ' DashPass Members only.';
        if (code && code.toLowerCase()!=='n/a') txt += ` ${code}.`;
      }

      if (hasSecondary.value==='Yes'){
        const sObj = (secondaryObjective.value||'N/A').trim();
        const sLOB = secondaryLOB.value || 'N/A';
        const sCTA = secondaryCTA.value || 'N/A';
        txt += `\n\nAlso include a secondary message where the objective is ${sObj} focused on ${sLOB} and CTA should be ${sCTA}`;
      }

      return txt.trim();
      function validateHasDollarOrPercent(node, errId){
        const v=(node.value||'').trim();
        const ok = /[$%]/.test(v) && v.length>0;
        showError(errId,!ok);
        return ok;
      }
    }

    // Generate Dasher
    function generateDasher(){
      let valid = true;
      valid &= validateRequired(d_channel,'d_channelErr');
      valid &= validateRequired(d_segment,'d_segmentErr');
      valid &= validateStartsWithWho(d_behavior,'d_behaviorErr');
      valid &= validateRequired(d_usecase,'d_usecaseErr');
      valid &= validateRequired(d_action,'d_actionErr');
      valid &= validateRequired(d_takeaway,'d_takeawayErr');

      if (d_hasPromo.value==='Yes'){
        valid &= validateRequired(d_promoType,'d_promoTypeErr');
        valid &= validateDate(d_startDate,'d_startErr');
        valid &= validateDate(d_endDate,'d_endErr');
        valid &= validateNumber(d_minDeliveries,'d_minErr');
        valid &= validateHasDollar(d_stdPayout,'d_stdErr');
        valid &= validateHasDollarOrNA(d_maxPayout,'d_maxErr');
        if (d_promoType.value==='streaks'){
          valid &= validateNumber(d_consecDays,'
